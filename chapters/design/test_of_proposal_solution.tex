\section{Test of proposal solution}
This chapter aims to design the measurement for the proposed solution. The measurement is based on an L-acoustics KUDO line source array, which is described as the first part of this chapter. Afterwards, the measuring setup for both crosswind and parallel wind is designed based on the used line source array and concert conditions. The second part of this chapter deals with the wind noise challenge in outdoor measurement. The end of this chapter design the measurement software and the needed sensors. 



\section{Description of the used line source array}\label{sec:prop:des_of_lin}

The description of the used line source array starts with an introduction to the line source element, where the frequency response of the single element is measured as well as the directional characteristics. In the end, the horizontal directionally control, and the vertical directionally control is explained.

The line source elements which is used to test the proposed solution is an L-Acoustics KUDO line source array. This line source array is a legacy long throw variable curvature speaker. This speaker is today renewed and renamed to L-acoustics K2. The line source array can be flown as a vertical line with a maximum of 21 elements. The maximum number of an element is due to the safety limit on the flying tools. 
One single element have a frequency response from \Hz{50} to \SI{18}{\kilo\hertz} with a approximatly deviation of $\pm$ \dB{3} and have a maximum \gls{spl} of \dB{140} at \SI{1}{\meter}. The following \autoref{fig:ap:kudo_freq_resp} shows a frequency response measurement of a single KUDO line source element in \SI{50}{\degree} horizontal angle. 

\plot{plot/kudo_freq_resp}{The graph shows the frontal frequency response in \SI{50}{\degree} horizontal angle}{fig:ap:kudo_freq_resp}

This measurement in \autoref{fig:ap:kudo_freq_resp} is done in the anechoic chamber at Aalborg University as well as the following measurement in this section. The measurement is explained in \autoref{ap:dir_of_kudo}. The horizontal coverage angle of the L-Acoustics KUDO can be controlled individually on every line source element. The line source element allows both symmetric horizontal coverage and asymmetric coverage. The angle from the frontal direction to the outer main lobe \dB{-6} is either \SI{25}{\degree} or \SI{55}{\degree}. By this two angle for both sides, four coverage angle of the speaker is possible, \SI{110}{\degree}, \SI{50}{\degree} and \SI{80}{\degree} ether to the left or the right. To obtain a better resolution that only the \dB{-6} the directionality characteristics is measured in all settings. The measurement can be founded in \autoref{ap:dir_of_kudo} . The interesting settings while rotating the line source array is \SI{25}{\degree} / \SI{25}{\degree} and \SI{25}{\degree} / \SI{55}{\degree} which is shown in \autoref{fig:ap:KUDO_25_25_des} and \autoref{fig:ap:KUDO_25_55_des} respectivly.

\plot{plot/KUDO_25_25_isobar_design}{The graph shows a contour plot with \dB{3} step of the directionally of the L-acoustics KUDO with \SI{25}{\degree} / \SI{25}{\degree} settings. The lower black contour line indicate the \db directionality for the maximum rotation of the speaker}{fig:ap:KUDO_25_25_des}

\plot{plot/KUDO_25_55_isobar_design}{The graph shows a contour plot with \dB{3} step of the directionally of the L-acoustics KUDO with \SI{25}{\degree} / \SI{55}{\degree} settings. The lower black contour line indicate the \db directionality for the maximum rotation of the speaker}{fig:ap:KUDO_25_55_des}

The mechanical directional characteristics solution in the L-acoustics KUDO as well as other line source array element is not made for wind challenge but for neighbouring disruptions and higher \gls{spl} in the main lobe of the high frequency. All solution used today is only possible to be changed by hand and is not electrically controlled. The method for changing the horizontal directivity in the L-Acoustics KUDO line source element is two plexiglass plate fixed to the front grill. The fixing mechanism can be adjusted sidewise by realising two splits on both plexiglass plates. The plate can then be slid along the grill to change the mouth of the speaker output. The following \autoref{fig:td:kud_dir} illustrate the principle.

\fig{kudo_directivity.pdf}{The figure shows how the horizontal directivity is controlled on a L-Acoustics KUDO line source array element \citep{KUDO_manual}.}{fig:td:kud_dir}{0.6}
While the plexiglass plates are in \SI{55}{\degree} mode as shown in \autoref{fig:td:kud_dir}, the wider directionallity is obtained by soundwave reflection on the plexiglass plate.

The line source array vertically coverage area can be controlled from \SI{0}{\degree} to \SI{10}{\degree} with \SI{1}{\degree} step size. To be able to control the vertical main lobe of the line source array, the mechanical solution is the angle between the line source element. This means that the vertical coverage control cannot be controlled on the individual line source element as the horizontal coverage. To be able to control the vertical coverage, the speaker is trapeze designed such that the high frequency horn throat stays together while the angle between the elements is adjusted in the back of the element. The following \autoref{fig:td:kud_dir_ver} shows how the line source element are angled vertically.

\fig{vertical_coverage_adjust.pdf}{The figure shows how the vertical directivity is controlled on a L-Acoustics KUDO line source array element \citep{KUDO_rig}.}{fig:td:kud_dir_ver}{0.5}

To be able to fix the vertical coverage on the L-acoustics KUDO, the upper left rigging pin shall only be placed into the line source element rig when the angle shown on the metal pease shows the desired vertical coverage angle between two line source element.  


\section{Designing the measurement}\label{sec:des:des_mes}
This section aims to design a measurement based on the proposed solution \autoref{sec:td:pro_sol_pro} and the properties of the used line source array founded in the previous section. The first part of this section gives a general overwrite of the measuring setup. Afterwards, the independent measurement structure is designed for the crosswind and the parallel wind, respectively.


\subsection{General measuring setup}\label{sec:pro:test_setup}
The line source measurement setup is designed such that the proposed solution can be tested without mechanical change of the line source array. The test setup, therefore, do not change the speaker directionality along with the measurement. Furthermore, the amount of available line source array for the measurement is limited to six line source element. The following \autoref{fig:td:tes_set} shows the line source speaker setup and start vertical angling for both the crosswind and side wind measurement. 

\xfig{design/test_setup.pdf_t}{The figure shows test setup for both beasurement}{fig:td:tes_set}{1}


\subsection{Crosswind line array settings} \label{sub:des:cros_set}
The idea is to measure the \gls{spl} coverage while playing in the frontal direction, and then measure the \gls{spl} coverage while the line source array is rotated against the wind. The search is then for the least \gls{spl} differences in the coverage area. To be able to ensure that the rotation of the line source array keeps the \gls{spl} in the downwards refraction direction as much as possible, this section designs the directional characteristics settings of the line source array doing the crosswind measurement.

It is founded in \autoref{sec:ana:atm_ref} that downwards refraction raises the \gls{spl} by downwards reflection but the amplification is much less than the attenuation in upwards refraction and is therefore assumed negligible for directionally chose. Therefore, to decide on the horizontal directionally settings is compared in different settings. The comparison uses the founded characteristics directionally of the line source array in \autoref{sec:prop:des_of_lin} and the crosswind measurement in \autoref{sec:ana:atm_ref}

As seen in \autoref{fig:ap:KUDO_25_25_des}, when the speaker is rotated \SI{25}{\degree} up against the wind, which is the rotation where the maximum \gls{spl} is pointed into the outer \dB{-6} coverage angle of the line source array, the downwards direction is lowered from approximately \dB{-6} to approximately \dB{-18}. This rotation occurs an attenuation of \dB{12}, which might be too high. While comparing with \autoref{fig:ap:KUDO_25_55_des} instead, the line source array rotation of \SI{25}{\degree} only attenuation the \gls{spl} in the downwards direction with \dB{6}. 

To decide on a mechanical solution an example is calculated based on the directionality measurement in \autoref{sec:prop:des_of_lin} and the crosswind measurement in \autoref{sec:ana:atm_ref}. The example is based on the optimal rotation for both directionality characteristics, where the difference between the upwards side and the downwards side is smallest. The following paragraph explains and shows the example.


\paragraph{Example} The example shows four cases of the L-Acoustics KUDO line source array. One case where the data from the datasheet is used, one case where the measurement in \autoref{sec:ana:atm_ref} is used. Then two examples where the differences in \gls{spl} is calculated from an rotation of \SI{20}{\degree} for \SI{25}{\degree} / \SI{55}{\degree} settings and a rotation of  \SI{10}{\degree} for \SI{25}{\degree} / \SI{25}{\degree} settings and added to the measurement. The following \autoref{fig:td:mail_lobe_cor} shows the example.


\xfig{design/main_lobe_correction.pdf_t}{The figure shows the main lobe coverage area without rotation for the to lower and with maximum rotation for the to upper}{fig:td:mail_lobe_cor}{1}

The centre in the measurement was not measured doing the measurement, so the stated value is a prediction based on \citep{review_of_sound} which indicate that the energy addition at short distances because of downwards refraction is small compared to the energy loss with upwards refraction. 

As seen in \autoref{fig:td:mail_lobe_cor} a rotational of \SI{20}{\degree} calculate a more homugenius \gls{spl} while the line source array is in \SI{25}{\degree} / \SI{55}{\degree} settings. The diviation from the frontal direction is approximatly \dB{3}. In the other case while the rotation is only \SI{10}{\degree} and the settings is \SI{25}{\degree} / \SI{25}{\degree} the \gls{spl} is also approximately evently spredt but the divination to the frontal direction is much higher and is at least \dB{-7.9}. Based on the calculated example, the chosen directionally settings is \SI{25}{\degree} / \SI{25}{\degree} for the measurement. The following \autoref{fig:td:speaker_rot} shows the measurement setup as a top wiev. 

\xfig{design/speaker_rotation.pdf_t}{The figure shows the line source setup for the measurement.}{fig:td:speaker_rot}{1} 

The rotated array is rotated with few degrees for every measurement form \SI{0}{\degree} until \SI{25}{\degree}, which mean that the highest possible \gls{spl} points in the maximum angle. 

The transfer function which shows the lowest \gls{spl} deviation between microphone position is the angle of the solution. 

\subsection{Parallel wind line array settings}\label{sub:des:par_set}

For parallel wind, the idea is to have horizontal symmetric coverage while changing the vertical angle for every measurement. The array is tilted some degree until the optimal angle is measured. The optimal angle is the angle where the shadow zone is pushed as far away as possible concerning the wind speed. The following \autoref{fig:td:vertical_coverage} illustrate the line source array from the side.

   
\xfig{design/vertical_coverage.pdf_t}{The figure shows the line source setup for the measurement. The line source array consist of six KUDO line source element attached with \SI{0}{\degree} vertical coverage angle}{fig:td:vertical_coverage}{1} 

The \autoref{fig:td:vertical_coverage} illustrate that the wind makes refraction of sound upwards and therefore the main lobe is curved upwards.




\subsection{Microphone position at crosswind}
This section aims to design the position of the measuring microphone. The position of the microphone depends on the wind condition, for the crosswind the microphone be placed in the sound field were for the parallel wind, the microphone shall be placed in the shadow zone. The description starts with the former.


The microphone position highly depends on the coverage area of the line source element. Usually, the element which is flown highest cover the as far as possible where the line source element which is closest to the ground cover the frontal audience. Therefore, the distance from the speaker to the microphone has to be found based on the knowledge of coverage distance and the minimum distance before refraction. The distances from the stage to the back audience depends on the size of the concert. For a small concert, the main stage covers the full area where for large concert delay tower helps the coverage. Delay tower is often used for a concert where the distances from the stage to the audience is above \SI{75}{\meter} as Roskilde festival. Roskilde festival situate there delay tower at a distance no longer than \SI{73}{\meter} from the main stage \autoref{ap:ques}. The general founded maximum distances from the main stage to the first delay tower was about \SI{73}{\meter} for a huge concert, \SI{50}{\meter} for a large concert and \SI{30}{\meter} for small concert \autoref{ap:ques}. Base on the knowledge of the maximum distances founded in \autoref{ap:ques} and that Roskilde festival is a special case concerning the size and \SI{50}{\meter} to \SI{60}{\meter} is an often used maximum distance for large concert depending on the hight of the main stage line array. The maximum coverage distances are chosen to be \SI{50}{\meter} for the test since the used line array flying tools is not able to fly the line array as high as the asked companies. The flying height of the top line source array element is about from \SI{12}{\meter} to \SI{16}{\meter} where the flying height of the used test setup is only up to \SI{7}{\meter}.  Furthermore it was shown in \autoref{ta:ana:spl_dif} that refraction occur at a distance of \SI{25}{\meter} with \SI{13}{\meter\per\second}.

Another factor which plays a specific role for the microphone distance from the sound source is the hight of the microphone. There are pros and cons for placing the microphone both at the ground or above the ground. The pros of placing the microphone on the ground are that the ground reflection is eliminated, but the cons are that the shadow zone might be closer to the line source array that above the ground, as it can be seen in \autoref{sec:ana:atm_ref}. Relating it to the concert situation, the ground reflection in the high frequency is assumed to be low where the ground reflection in the low frequency range is assumed to be higher. Moreover, the hight of the audience ear is not at the ground but in a hight of approximately \SI{1.70}{\meter} therefore the most realistic scenario without the audience is at the ear height with an additional ground reflection attenuation mechamisme.


Since the measuring distance is chosen to be \SI{50}{\meter} the angel of the speaker is chosen to be the lowest possible angle. This choice is taken because the coverage area at that distance is high at the narrow-angle and is a realistic chose from the company and concert area point of view.?? The following \autoref{fig:td:ang_mea} shows the microphone position with respect to the speaker position. 
%%%

\xfig{design/angle_measurement.pdf_t}{The figure shows the measurement setup}{fig:td:ang_mea}{1} 


\subsection{Microphone position at parallel wind}
The microphone position of the vertical refraction measurement depends on the shadow zone position, and it is wanted to measure in the shadow zone to explore if it is possible to move the shadow zone backwards by tilting the line array. The following \autoref{fig:td:ang_mea_ver} illustrate the two measuring cases, which is needed to be measured to conclude on the idea. 

%\xfig{design/angle_measurement_vertical.pdf_t}{The figure shows the measurement setup}{fig:td:ang_mea_ver}{1} 

As seen in \autoref{fig:td:ang_mea_ver} one measurement is where the microphone is within the refracted main lobe of the line source array and one is outside the main lobe of the line source array. To be able to test this senario, two measuring cases is designed, one where the main lobe of the line array is angled such that it propagate directly intro the ground in front of all microphone. This measuring case is shown in \autoref{fig:td:parallal_n7}. 

\xfig{design/parallal_n7.pdf_t}{The figure shows the measurement setup while the line source array is tilted \SI{7}{\degree} forward}{fig:td:parallal_n7}{0.9} 

As seen in \autoref{fig:td:parallal_n7} the main lobe of the line source array is assumed to be near-field which is only hold for high frequencies. At a distances of \SI{40}{\meter} this illustration covers frequencies above \Hz{6000}, frequencies below will will be wider as the frequency drop \autoref{sec:ana:geo_spr_los}. But anyway, the highest power of the line source array lays within the center of the main lobe in the frequency of interest due to the directionality charastics of the line source array. In this case the microphone should be without the main lobe while no wind refraction effect the sound, but as the wave is refracted, the microphone is within the main lobe. To make a compainson test case while upwards refraction is present, a test case is designed where the microphone is within the main lobe of the line source array. The following \autoref{fig:td:parallal_n3} illustrate the test case.

\xfig{design/parallal_n3.pdf_t}{The figure shows the measurement setup while the line source array is tilted \SI{3}{\degree} forward}{fig:td:parallal_n3}{0.9} 

In the test case shown in \autoref{fig:td:parallal_n3} more \gls{spl} is delivered to the microphone compare to the test case in  \autoref{fig:td:parallal_n7}. while no wind is present the case in \autoref{fig:td:parallal_n3} delivers the highest \gls{spl} to the center microphone microphone and the back microphone, since they are within or at the border of the main lobe. While upwards refraction is present, the proposal solution in \autoref{sec:des:pro_para} sedjest that the refraction refract the sound wave such the \gls{spl} distribution is vise versa. The upwards refraction refract the sound wave in \autoref{fig:td:parallal_n7} above the microphone and the refraction of the soundwave in \autoref{fig:td:parallal_n3} refract the soundwave to the microphone. In this test case the microphone is situated on the ground such that the microphone is as deep in the shadow zone as possible. In other words, as shown in \autoref{fig:td:eddies}, while the microphone is positionede in the same distance from the line source array, while the microphone is on the ground compare to lifted above the ground, the shadow zone is most present at the ground. If more \gls{spl} is present in the \autoref{fig:td:parallal_n7} compare to \autoref{fig:td:parallal_n3} the shadow zone distance might be able to be optimised.

\section{Rotation of the line source array}
The aim of this section is to design the turning method for the line source array and ensure that the speaker point in the desired angle. A mechanical solution is chosen for both rotation of the line source array and measuring the rotational angle of the line source array. The mechanical solution to rotate the line source array is a long piece of truss connected to the back of the flying tools of the line source array. By this mechanical solution, a person is able to move the other end of truss and stabilise the angle by placed the end of the truss on the ground. Moreover to ensure that the rotation is dome with a specified angle, two laser pointer is attached beneth the line source array. One in the vertical rotation angle and one behind. The one on the rotational axis is then the reference to the back laser pointer. The following \autoref{} illustrate the solution.

\xfig{design/rotation_and_angling.pdf_t}{The figure shows the rotational mechanic where the blue dashed line illustrate the vertical rotational axis.}{fig:td:rotation_and_angling}{1}  

In \autoref{fig:td:rotation_and_angling} the reader shall imagine by moving the ground position of the rotational truss towards the reader of away from the reader, the line source array is rotated. The laser pointer holder and plate for measuring the angel is shown in the following two \autoref{fig:td:mes_ang_plate} and \autoref{fig:td:mes_las_hol}.


\begin{figure}[H]
    \centering
     \captionsetup{width=1\linewidth}
    \begin{minipage}{0.36\textwidth}
        \centering
         \captionsetup{width=0.90\linewidth}
       \input{figures/design/measuring_angle_plate.pdf_t}
        \caption{The figure shows the angle plate.}
        \label{fig:td:mes_ang_plate}
    \end{minipage}%
    \begin{minipage}{0.56\textwidth}
        \centering
         \captionsetup{width=0.90\linewidth}
        \input{figures/design/laser_holder.pdf_t}
        \caption{The figure shows the laser holder.}
        \label{fig:td:mes_las_hol}
    \end{minipage}
\end{figure}


The reference laser pointer is guided intro hole 1 in \autoref{fig:td:mes_las_hol} which is at the rotational axis while the line source array is tilted \SI{3}{\degree}. The back laser is guided into hole 10 such that the highest distance between the laser is achieved. The measuring angle plate is then placed on the ground with the reference laser pointing at the center and the back laser pointing at the \SI{0}{\degree} angle while the line source points directly forward. 



\subsection{Design of windscreen}
The aim of this section is to be able find a windscreen to the measuring microphone such that the wind noise is low compare to the measuring signal. There is to aspect in this windscreen configuration, firs the the wind noise cannot be filtered electronical between the microphone and the preamp.Therefore the strength of the wind noise shall be as low as the preamp do not overload. Secondly the measurement shall be measurement of the signal and not the wind noise, therefore the signal shall be sufficiant higher that the wind noise such that the measurement is trustable and represent the \gls{spl} procused of the speaker at the measuring point. 

The idea of an additional wind screen is use the original windscreen to the microphone and then try to stop the wind in just at the microphone with a blocking surface. The surface shall therefore be able to lower the windspeed at the microphone and have as less reflection as possible. The original windscreen is cept on the microphone in the wind stop area to attenuate the wind noise that passes the blockaga and attenuate the turbulence prodused by the wind stopper. 

%There is to wind stopping concept that will be tested, a plan surface of rockwool as shown in \autoref{} and a foam wedge solution as shown in \autoref{}
    
    %To be sure that the wind noise does not affect the measurement the part of the design takes care about finding the preferable microphone windscreen configuration, based on the available equpment in acoustics lab. The second part measure the frequency dependent attenuation of the chosen windscreen compare to the microphone response without a windscreen. The comparison is done to count for the attenuation of the windscreen such that the measured data reflect the \gls{spl} at the point as pleasant as possible. 


\subsection{Final windscreen solution}
Based on the above finding the final windscreen is designed. The design of the final windscreen combines configuration two to and and a updated version of configuration four where the stability problem is solved. This combination is chosen since this two configuration shows the best performance in lowering the wind speed near the microphone and a combination might optimise the wind speed and noise further. Moreover it is chosen that the microphone shall be at the hight of the ear, therefore, an additional ground plan is added to try to stop the ground reflection as much as possible. 

As the first test of the final windscreen solution an preliminary setup is done with the available material in acoustics lab. The preliminary setup is defined as windscreen configuration five. The following \autoref{fig:td:mes_roc_foa_con} illustrate the concept.

\xfig{design/measure_rock_foam_concept.pdf_t}{The figure shows the single rockwool concept. This concept is defined as windscreen configuration five.}{fig:td:mes_roc_foa_con}{1}  

This configuration is measured to have more wind speed attenuation that this combination apart. The wind speed attenuation shows that the mean wind speed is lowered from \SI{8}{\meter\per\second} to \SI{0.8}{\meter\per\second}, but the directional turbulence is less stable compare to the configuration the windscreen with only foam wedge. The frequency response of the windscreen configuration is as configuration two but with little closer fit to without windscreen in the high frequency.

To deal with the stability problem of the rockwool bat, the rockwool bat is replaced be PVC foam mounted on a circular wood plate as the following \autoref{fig:td:mes_win_opt_ver} illustrate

\xfig{design/windscreen_optimised.pdf_t}{The figure shows the single rockwool concept}{fig:td:mes_win_opt_ver}{1}  

The change in material is made based on the better stability of PVC foam and that the foam wedge is assumed to cancel the reflection from the PVC foam. While adding the wood plate the original windscreen to the microphone then lift the microphone \SI{4.5}{\centi\meter} from the wood plate which might result in sound reflection from the wood plate. To eliminate the reflection from the wood plate the technique from wind turbine measuring setup is used where the windscreen is cutted. In the wind turbine microphone setup the cut is done such that half of the microphone is cutted down intro the wood plate, in this configuration on ... is avalible, therefore this cut is not sutable. The cut is therefore made \SI{2}{\milli\meter} to \SI{3}{\milli\meter} beneth the microphone such that the microphone is full covered by the original windscreen. The cut is illustrated in the following \autoref{fig:td:original_windscreen}. 

\xfig{design/Original_windscreen.pdf_t}{The figure shows the modified original windscreen}{fig:td:original_windscreen}{1}  





\subsection{windscreen wind noise attenuation}\label{sec:ds:wind_noi_att}
This section aims to research the wind noise in the windscreen to ensure that the wind noise in real condition does not overload the microphone. The measurement is done both with and without the designed windscreen to decide if the windscreen works in the real senario with high speed and directionallity changing wind. The measurement is furthermore done both in the ear hight and on the ground to research is one position have better signal to noise condition in the final measurement. The first preformed measurement is two measurement, one in the ear hight and one on the ground. Both measurement is preformed with the designed windscreen. The measurement is done in the same vertical position where the stand is removed and therefore the measurement is not done in parallel. The measurement is done 10 times on each position, such that to measurement with nearly the same wind speed can be compared. The windscreen is placed \SI{90}{\degree} agenst the wind, which means that the windscreen is placed in its optimal position where the wind blows directly onto the wide PVC plate. The following \autoref{fig:dt:windnoise_with_screen} shows the result.

\plot{plot/windnoise_with_screen_dt}{The graph shows the frequency content of the measurement with the windscreen in the hight of the ear and on the ground}{fig:dt:windnoise_with_screen}

As it is seen in \autoref{fig:dt:windnoise_with_screen}, the wind noise highly depends on the hight of the windscreen position. By lowering the windscreen from the ear hight done to the ground surface, the wind noise is lowered with approximately \dB{20} in the low frequency, which is the frequency area where the wind noise is highest. Furthermore it is research if the designed windscreen have hgiher wind noise attenuation compare to only the modified original windscreen. The following \autoref{fig:dt:windnoise_compare} shows the result.
 
\plot{plot/windnoise_compare}{The graph shows the frequency content of the measurement with and without the windscreen}{fig:dt:windnoise_compare}

As seen in \autoref{fig:dt:windnoise_compare}, the windscreen have generally a \dB{5} to \dB{10} wind noise attenuation. The measurement description is founded in \autoref{ap:wind_noise_in_design}. The measurement description also shows noise measurement of the windscreen where the windscreen is rotated both to the left and to the right. 



\section{Data logging system} 
This section aims to explain the measuring tools doing the designed measuring. To be able to measure the weather condition hardware have to be chosen and designed. To be able to transfer data from the hardware to the measuring software, a small microprpcessor is programed to read sensor data end transfer the data to the measuring software. This part then first explain the desided and designed hardware. Then is explain the weather measuring firmware for the microprocessor. Then it explain the measuring software. 

\subsection{Software}
This section gives a short overview over the \matlab software used for the test. The overview do not include any code but only the method of measuring the impulse response and get synchronised data from the serial bus. 

The impulse response is measured with sine sweep according to \citep{mller2001transfer}. The method is to deconvolute the measured signal by the reference signal which produce the impulse response. In the measuring software, the deconvolution is done in frequency domain, because it speed up the calculation. both the measured signal and the reference signal is windowed by a hanning window. To exclude the influence of the sound card, the reference signal is played through one output channel and measured by one of the microphone input. It is assumed that the charasticistic of every output and input is equal. To be able to make calibrated impulse responses, the measured reference signal is related to the microphone input by the following \autoref{eq:relate}

\begin{equation}\label{eq:relate}
\text{ref}_{s} = \text{ref}_{m} \cdot    \frac{\text{mic}_{sen}}{rms(\text{ref}_{m})}
\end{equation}

\startexplain
\explain{\text{ref}_{s}}{is the calibrated reference signal}{1}
\explain{\text{ref}_{m}}{is the measured reference signal}{1}
\explain{\text{mic}_{sen}}{is the rms sensitivity of the microphone in digital number at one pascal rms}{1}
\stopexplain

After the reference signal is related to the measured signal, deconvelution is calculated by calculating the \gls{fft} for both signal, divide the measured signal by the reference signal and calculate the \gls{ifft}. The result is an impulse response where the amplitude correspond to a calibrated pascal value. By the impulse response both the octave \gls{spl} can be calculated and the frequency response. 

The syncronisation between the measured frequency response signal and the weather information is done along the time measurement. The \matlab software comnucate with the sound card by transfering 4096 audio sample to the sound card and 4096 measured sample back the the \matlab software. After the 4096 sample is resived by the program one weather sample is readed from the serial bus. This procedure is is started over until the full sweep is measured. All weather information and sound information is stored intro an mat file after every measurement such that the analysis can be done offline.

The measuring software is founded in  \autoref{ap:imp_res_meas_soft}

\subsection{Firmware}
The firmware is designed to support two wind anemometer, one temperature and one humidity sensor. The temperature and humidity sensor is one unit and communicate digitally to the Arduino. The communication is done through the dht.h Arduino library with no addition. The data is then called from a function of the library and no digital connection is designed by the author. 
The wind sensor both measure the wind direction and the wind speed. The wind direction is an analogue voltage from \SI{0}{\volt} to \SI{5}{\volt} while the angle goes from \SI{0}{\degree} to \SI{359}{\degree}. The rotational angle from the sensor increases while the directional goes from south to west, therefore it works in the same direction as a compass. The analogue voltage is measured with the build in 10 bit \gls{adc} which gives digital number from 0 to 1024. This measured number is transfered directly to the com bus without angle correction. The conversion to angle is done in \matlab . The wind speed measurement sensor gives a pulse for every rotation. According to the data sheet of the wind anemometer, one rotation of the wind speed sensor over a time period of \SI{1}{\second} correspond \SI{1.0058}{\meter\per\second}. To be able to measure the wind speed in a higher resolution that \SI{1.0058}{\meter\per\second} the pulses is time average over a defined period. To be able to measure over a period a \gls{fifo} buffer is designed for the pulses as shown in the following \autoref{fig:td:fifo:buffer} 
\xfig{design/fifo_buffer.pdf_t}{The figure shows the \gls{fifo} buffer system for wind speed measurement}{fig:td:fifo:buffer}{1}  

As seen in \autoref{fig:td:fifo:buffer}, the update time is for every \SI{185}{\milli\second} and the buffer contains 16 pieces of \SI{185}{\milli\second} which gives an average time over \SI{2.96}{\second}. This buffer size gives an wind speed resolution of \SI{339.8}{\milli\second\per\meter}. The update time is slower that the data transfer time interval between the Arduino and \matlab. \matlab ask for data for every \SI{92.9}{\milli\second}. The \SI{92.9}{\milli\second} cams from the differences between the sampling frequency and the buffer size of data between \matlab and the sound card which is 4096 samples. The choise of the approximately half update time is chosen based on the design of the firmware. The firmware is synchronised with \matlab by adding a delay in the main loop and not tricking on a counter. Therefore, the program runtime is fully stabil down to \SI{1}{\milli\second} precision. The firmware update between 91 ms to 96 ms which mean that the \matlab gets new data for every weather update. The mean update time for the firmware is therefore 92.3 ms based on 80 time measurement sample.  The negative shift of the firmware update doing the 55 weather update is then -38.8 ms which is less that 92.3 ms and therefore, no time shift is present by the lack of fully synchronization. But since the update sometimes is above \SI{92.9}{\milli\second} the warther updates sample to \matlab can be the same twice. This issue is only present in the first 5 samples, after thoes samples the lack in synchronisation does that 96 ms is an update before the software ask for weather data samples. 

Based on the above explaination, the following weather data is present in the refraction measurement, where it shall be noted that within the first few sample, an repetition can occur. This repetition is considered as indifferent, since the first \SI{500}{\milli\second} is a starting silince period of the sine sweep and frequency below \SI{40}{\hertz} and, therefore, is removed from the data analysis. 

\begin{itemize}
\item The wind direction is updated for every weather sample.  
\item The wind speed is updated for every second weather sample.
\item The temperature and humidity is updated for every weather sample.
\item The \matlab software ask in total for 55 weather samples doing one measurement. 
\end{itemize}

The data transfer is done through the serial bus vis \gls{usb} connection. The following \autoref{tp:com_snapshot} shows a snapshot of the serial bus delivered by the Arduino.


\begin{figure}[H]
\centering
	  \captionsetup{width=0.57\linewidth}
	  \footnotesize
\begin{tabular}{llllll}
Speed 1 & Direc 1 & Speed 2 & Direc 2 & Temp  & Hum   \\ \hline
5.44    & 790     & 6.12    & 884     & 21.90 & 68.90 \\
5.44    & 791     & 6.12    & 882     & 21.90 & 68.90 \\
4.42    & 790     & 5.78    & 863     & 21.90 & 68.90 \\
4.42    & 791     & 5.78    & 832     & 21.90 & 68.90 \\
3.74    & 790     & 5.44    & 820     & 21.90 & 68.90 \\
3.74    & 790     & 5.44    & 827     & 21.90 & 68.90 \\
3.40    & 791     & 5.10    & 831     & 21.90 & 68.90 \\
3.40    & 790     & 5.10    & 832     & 21.90 & 68.90
\end{tabular}
\caption{The figure shows a snapshot of the serial bus. The first vertical line, which is the left vertical data line is the wind speed of the first anemometer.  The second vertical line is the wind direction of the first anemometer. The third vertical line is the wind speed of the second anemometer.  The fourth vertical line is the wind direction of the second anemometer. The fifth vertical line is the temperature and the last vertical line is the humidity.}
\label{tp:com_snapshot}
\end{figure}%


The firmware is founded in \autoref{ap:wet_code}


\subsection{Hardware}
The hardware for weather measurement is based on an Ardouino UNO. The chose of an arduino is made because code both the temperature and humidity censor and the used anemometer is avelable online. 

The chosen temperature and humidity sensor is an AM2302 bacause it is avelible as a component at Aalborg university and it covers raletive humidity from \SI{0}{\percent} to \SI{100}{\percent} and temparature range from \SI{-40}{\celsius} to \SI{80}{\celsius}. The data sheet of the sensor is founded in \citep{temp_sens}.


The chosen anemometer is an Davis Vantage Pro2 anemometer. This anemometer is chosen because the output connection is directly to the speed sensor and the direction sensor. The direction sensor is an \SI{20}{\kilo\ohm} \SI{360}{\degree} potentiometer, where the speed sensor is an contact which make one short circuit to ground for every rotation. The directional sensor can therefore be measured by an analog input where the speed sensor can be measured by an digital input. The data sheet for the anemometer is founded in \citep{anemometer_sens}

To be able to connect both two sensors and two anemometer to the Ardouino UNO an Ardouino shield is designed. 


\dfig{ard_schematic.pdf}{The figure shows the schematic of the shield}{ard_shield.pdf}{The figure shows the layout of the shield}{Ardouino shield design}{fig:td:ard_shield}{0.62}{0.38}


The to resistors in \autoref{fig:td:ard_shield} R1 and R2 is pull-up resistors for the wind speed contact. While the contact in the anemometer is non shortet, the voltage at the input pin on the Arduino is \SI{5}{\volt}. while the contact is shorted the voltage is \SI{0}{\volt}. The two RJ11 connectors is for the Anemometer connection. The six test point is soldering connection to the temperature and humidity sensor. 

All hardware can be seen in \autoref{ap:hardware}






\section{Measuring area}
To measure the \gls{spl} coverage of the speaker a flat area with mown grass is chosen to be used. The optimal area area without any building or trees might not be posible, therefore blockage or sound reflaction surface other than the ground is only allowed to be present in the double of distance compare to the distance from the speaker to the microphone. Based on the refraction effect versus distance founded in \autoref{sec:ana:atm_ref}. The distance from the speaker to the microphone array is chosen to be \SI{50}{\meter}. The distance is based on the experience of the author described in \autoref{sec:ana:aut_exp_con} and the founded refraction effect in \autoref{sec:ana:atm_ref}. It was founded that the refraction effect should be minimal at a distance of \SI{50}{\meter} when the speed of wind is \SI{5}{\meter\per\second}. 


To keep the wind speed realistic for measurement and for concert, but still having wind pressent, the wind speed doing the measurement is limited in the range for average \SI{5}{\meter\per\second} to \SI{10}{\meter\per\second}. Less average wind speed than \SI{5}{\meter\per\second} is avoided to ensure measureble effect of the wind on sound propagation. The higher limit of the \SI{10}{\meter\per\second} is chosen to ensure that the speaker tower is safe at the hight at \SI{6}{\meter}. The limited size of the setup makes the setup wind (følsom) because it is not puttet up as a cube but only as a surface. 